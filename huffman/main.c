#include <stdlib.h>
#include <stdio.h>
#include <ctype.h>
#include "huffman.h"

void hexdump(const void *pAddressIn, long  lSize)
{
 char szBuf[100];
 long lIndent = 1;
 long lOutLen, lIndex, lIndex2, lOutLen2;
 long lRelPos;
 struct { char *pData; unsigned long lSize; } buf;
 unsigned char *pTmp,ucTmp;
 unsigned char *pAddress = (unsigned char *)pAddressIn;

   buf.pData   = (char *)pAddress;
   buf.lSize   = lSize;

   while (buf.lSize > 0)
   {
      pTmp     = (unsigned char *)buf.pData;
      lOutLen  = (int)buf.lSize;
      if (lOutLen > 16)
          lOutLen = 16;

      /* create a 64-character formatted output line: */
      sprintf(szBuf, " |                            "
                     "                      "
                     "    %08lX", (long unsigned int)(pTmp-pAddress));
      lOutLen2 = lOutLen;

      for(lIndex = 1+lIndent, lIndex2 = 53-15+lIndent, lRelPos = 0;
          lOutLen2;
          lOutLen2--, lIndex += 2, lIndex2++
         )
      {
         ucTmp = *pTmp++;

         sprintf(szBuf + lIndex, "%02X ", (unsigned short)ucTmp);
         if(!isprint(ucTmp))  ucTmp = '.'; /* nonprintable char */
         szBuf[lIndex2] = ucTmp;

         if (!(++lRelPos & 3))     /* extra blank after 4 bytes */
         {  lIndex++; szBuf[lIndex+2] = ' '; }
      }

      if (!(lRelPos & 3)) lIndex--;

      szBuf[lIndex  ]   = '|';
      szBuf[lIndex+1]   = ' ';

      printf("%s\n", szBuf);

      buf.pData   += lOutLen;
      buf.lSize   -= lOutLen;
   }
}

int main()
{
	const unsigned char input[] = {0xee, 0xfc, 0xdd, 0xc9, 0xb4, 0x53, 0x60, 0xd7, 0x7c, 0xaa, 0xb2, 0xdc, 0xb4, 0x7a, 0xbe, 0xb3, 0xc8, 0xed, 0x71, 0x4d, 0x42, 0x83, 0x55, 0x0b, 0x0b, 0xcf, 0x14, 0xac, 0x02, 0x93, 0xf4, 0xd8, 0x53, 0xc3, 0x3a, 0xb0, 0xce, 0x9e, 0x3b, 0x58, 0x05, 0x26, 0x1d, 0xec, 0xd1, 0x9b, 0xa4, 0x37, 0xe9, 0xec, 0x39, 0xb0, 0x8e, 0x49, 0x07, 0x7b, 0x72, 0x93, 0x8e, 0x49, 0x67, 0xcf, 0x1f, 0xd6, 0x81, 0x95, 0xef, 0x31, 0x61, 0x55, 0x99, 0xd4, 0xef, 0x11, 0x93, 0xa6, 0x4c, 0xea, 0xf7, 0xdc, 0x4c, 0xd2, 0x9b, 0xd4, 0xef, 0xd9, 0xc0, 0x4a, 0x80, 0x65, 0x0a, 0xe1, 0xd9, 0x61, 0x15, 0xc0, 0xda, 0x60, 0xcf, 0x02, 0x56, 0x81, 0x49, 0x3b, 0x66, 0x56, 0xd9, 0x83, 0x85, 0x50, 0xf1, 0x02, 0x71, 0xa5, 0x61, 0x21, 0xb0, 0xde, 0xf5, 0xf5, 0xb8, 0xcd, 0x87, 0x1f, 0xfd, 0x9b, 0xa0, 0x69, 0x75, 0xcd, 0x50, 0x89, 0x6b, 0x90, 0xc6, 0xb1, 0x1c, 0x2b, 0x14, 0xdf, 0x8f, 0xae, 0xd4, 0x44, 0x16, 0x92, 0x92, 0x1c, 0xef, 0x2b, 0xdd, 0x49, 0x52, 0x27, 0xc7, 0xfb, 0x4a, 0x77, 0x92, 0xd4, 0xc9, 0xf1, 0xbe, 0xd2, 0x9d, 0xa4, 0x24, 0xc7, 0xfb, 0x4a, 0x77, 0x1c, 0xe4, 0xae, 0x41, 0x1b, 0x4d, 0xbe, 0xb1, 0x80, 0x32, 0x69, 0xb0, 0x52, 0x2b, 0x24, 0xa9, 0x93, 0xe3, 0xe9, 0x9c, 0x24, 0x75, 0x72, 0xbc, 0xaf, 0x74, 0x27, 0x49, 0x9d, 0x1c, 0xef, 0x2b, 0xdd, 0x49, 0x4a, 0x72, 0xbc, 0xaf, 0x74, 0x87, 0x2a, 0x4b, 0x4a, 0xba, 0xd3, 0x48, 0x9d, 0x2e, 0x47, 0x7d, 0x7c, 0xc5, 0x0d};
	unsigned char output[1394];
	int outsize;
	Huffman hf;
	HuffmanInit(&hf);
	outsize = HuffmanDecompress(&hf, input, sizeof(input), &output, sizeof(output));
	hexdump(output, outsize);
	return 0;
}
